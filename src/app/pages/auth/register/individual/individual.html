<div class="my-12 md:my-24">
    <h1 class="my-8 text-4xl font-semibold text-center">{{ 'register.title' | transloco }}</h1>

    <form [formGroup]="form" (ngSubmit)="submit()" class="py-8 mx-auto space-y-4 max-w-[29rem] autofill-fix">
        <div class="grid gap-4 items-stretch md:grid-cols-2">
            <div class="flex flex-col gap-3 items-center h-36">
                <div class="overflow-hidden relative w-36 h-full rounded-full border group">
                    @if (photoPreview()) {
                        <img
                            [src]="photoPreview()"
                            alt="Photo"
                            class="object-cover absolute inset-0 w-full h-full cursor-pointer"
                            (click)="removePhoto()"
                        />
                        <div
                            class="flex absolute inset-0 justify-center items-center text-xs text-white rounded-full opacity-0 transition cursor-pointer bg-black/40 group-hover:opacity-100"
                            (click)="removePhoto()"
                        >
                            {{ 'common.delete' | transloco }}
                        </div>
                    } @else {
                        <div class="flex flex-col justify-center items-center w-full h-full text-center">
                            <span class="text-3xl leading-none">+</span>
                            <span class="px-5 text-xs">{{ 'register.addPhoto' | transloco }}</span>
                        </div>
                        <input
                            type="file"
                            class="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
                            accept="image/*"
                            (change)="addPhoto($event)"
                        />
                    }
                </div>
            </div>
            <div class="space-y-3 h-full">
                <div class="flex flex-col">
                    <select formControlName="gender" class="appearance-none px-3 py-2 rounded border text-[0.85rem]">
                        <option value="">{{ 'register.gender.select' | transloco }} *</option>
                        <option value="female">{{ 'register.gender.female' | transloco }}</option>
                        <option value="male">{{ 'register.gender.male' | transloco }}</option>
                    </select>
                </div>
                <div class="flex flex-col">
                    <input
                        type="text"
                        formControlName="lastName"
                        class="px-3 py-2 rounded border"
                        placeholder="{{ 'register.fields.lastName' | transloco }} *"
                    />
                </div>
                <div class="flex flex-col">
                    <input
                        type="text"
                        formControlName="firstName"
                        class="px-3 py-2 rounded border"
                        placeholder="{{ 'register.fields.firstName' | transloco }} *"
                    />
                </div>
            </div>
        </div>

        <div class="grid gap-4 md:grid-cols-2">
            <div class="flex flex-col">
                <input
                    type="date"
                    formControlName="birthDate"
                    class="px-3 py-2 rounded border"
                    placeholder="{{ 'register.fields.birthDate' | transloco }}"
                />
            </div>
            <div class="flex flex-col">
                <input
                    type="email"
                    formControlName="email"
                    class="px-3 py-2 rounded border"
                    placeholder="{{ 'register.fields.email' | transloco }} *"
                />
            </div>
        </div>

        <div class="grid gap-4 md:grid-cols-2">
            <div class="flex flex-col">
                <input
                    type="password"
                    formControlName="password"
                    class="px-3 py-2 rounded border"
                    placeholder="{{ 'register.fields.password' | transloco }} *"
                />
            </div>
            <div class="flex flex-col">
                <input
                    type="password"
                    formControlName="confirmPassword"
                    class="px-3 py-2 rounded border"
                    placeholder="{{ 'register.fields.passwordConfirm' | transloco }} *"
                />
            </div>
        </div>

        <div class="grid gap-4 md:grid-cols-2">
            <div formGroupName="address" class="contents">
                <div class="flex flex-col">
                    <input
                        type="text"
                        formControlName="streetNumber"
                        class="px-3 py-2 rounded border"
                        placeholder="{{ 'register.fields.address.number' | transloco }} *"
                    />
                </div>
                <div class="flex flex-col">
                    <input
                        type="text"
                        formControlName="streetName"
                        class="px-3 py-2 rounded border"
                        placeholder="{{ 'register.fields.address.street' | transloco }} *"
                    />
                </div>
                <div class="flex flex-col">
                    <input
                        type="text"
                        formControlName="additionalInfo"
                        class="px-3 py-2 rounded border"
                        placeholder="{{ 'register.fields.address.complement' | transloco }}"
                    />
                </div>
            </div>
            <div class="flex flex-col">
                <input
                    type="tel"
                    formControlName="phone"
                    class="px-3 py-2 rounded border"
                    placeholder="{{ 'register.fields.phone' | transloco }} *"
                />
            </div>
            <div formGroupName="address" class="contents">
                <div class="flex flex-col">
                    <input
                        type="text"
                        formControlName="postalCode"
                        class="px-3 py-2 rounded border"
                        placeholder="{{ 'register.fields.address.zip' | transloco }} *"
                    />
                </div>
                <div class="flex flex-col">
                    <input
                        type="text"
                        formControlName="city"
                        class="px-3 py-2 rounded border"
                        placeholder="{{ 'register.fields.address.city' | transloco }} *"
                    />
                </div>
            </div>
        </div>

        <div class="flex gap-2 items-center">
            <input type="checkbox" [checked]="form.value.offerServices" (change)="toggleOfferServices($event)" />
            <span>{{ 'register.offerServices' | transloco }}</span>
        </div>

        @if (form.value.offerServices) {
            <div class="pt-4 space-y-4 border-t">
                <div class="grid gap-6 md:grid-cols-2">
                    <div class="flex flex-col gap-3 items-center">
                        <div class="overflow-hidden relative w-40 h-28 rounded-md border group">
                            @if (idPreview()) {
                                <img
                                    [src]="idPreview()"
                                    alt="Carte d'identitÃ©"
                                    class="object-cover w-full h-full cursor-pointer"
                                    (click)="removeId()"
                                />
                                <div
                                    class="flex absolute inset-0 justify-center items-center text-xs text-white opacity-0 transition cursor-pointer bg-black/40 group-hover:opacity-100"
                                    (click)="removeId()"
                                >
                                    {{ 'common.delete' | transloco }}
                                </div>
                            } @else if (idName()) {
                                <div
                                    class="flex justify-center items-center w-full h-full text-center cursor-pointer"
                                    (click)="removeId()"
                                >
                                    <span class="text-[10px]">{{ idName() }}</span>
                                    <span
                                        class="flex absolute inset-0 justify-center items-center text-xs text-white opacity-0 transition cursor-pointer bg-black/40 group-hover:opacity-100"
                                        (click)="removeId()"
                                        >{{ 'common.delete' | transloco }}</span
                                    >
                                </div>
                            } @else {
                                <div class="flex flex-col justify-center items-center w-full h-full text-center">
                                    <span class="text-4xl leading-none">+</span>
                                    <span class="mt-1 text-xs">{{ 'register.addId' | transloco }}</span>
                                </div>
                                <input
                                    type="file"
                                    class="absolute inset-0 opacity-0 cursor-pointer"
                                    accept="image/*,.pdf"
                                    (change)="addId($event)"
                                />
                            }
                        </div>
                    </div>
                    <div class="flex flex-col gap-3 items-center">
                        <div class="overflow-hidden relative w-40 h-28 rounded-md border group">
                            @if (ribPreview()) {
                                <img
                                    [src]="ribPreview()"
                                    alt="RIB"
                                    class="object-cover w-full h-full cursor-pointer"
                                    (click)="removeRib()"
                                />
                                <div
                                    class="flex absolute inset-0 justify-center items-center text-xs text-white opacity-0 transition cursor-pointer bg-black/40 group-hover:opacity-100"
                                    (click)="removeRib()"
                                >
                                    {{ 'common.delete' | transloco }}
                                </div>
                            } @else if (ribName()) {
                                <div
                                    class="flex justify-center items-center w-full h-full text-center cursor-pointer"
                                    (click)="removeRib()"
                                >
                                    <span class="text-[10px]">{{ ribName() }}</span>
                                    <span
                                        class="flex absolute inset-0 justify-center items-center text-xs text-white opacity-0 transition cursor-pointer bg-black/40 group-hover:opacity-100"
                                        (click)="removeRib()"
                                        >{{ 'common.delete' | transloco }}</span
                                    >
                                </div>
                            } @else {
                                <div class="flex flex-col justify-center items-center w-full h-full text-center">
                                    <span class="text-4xl leading-none">+</span>
                                    <span class="mt-1 text-xs">{{ 'register.addRib' | transloco }}</span>
                                </div>
                                <input
                                    type="file"
                                    class="absolute inset-0 opacity-0 cursor-pointer"
                                    accept="image/*,.pdf"
                                    (change)="addRib($event)"
                                />
                            }
                        </div>
                    </div>
                </div>
                <div class="grid gap-4 md:grid-cols-2">
                    <div class="flex flex-col">
                        <label class="mb-3 font-medium">{{ 'register.fields.trades' | transloco }}</label>
                        <div class="flex flex-wrap gap-2">
                            @for (trade of tradesKeys; track trade) {
                                <button
                                    type="button"
                                    (click)="toggleTrade(trade)"
                                    class="chip"
                                    [class.selected]="isTradeSelected(trade)"
                                >
                                    {{ 'register.options.trades.' + trade | transloco }}
                                </button>
                            }
                        </div>
                    </div>
                    <div class="flex flex-col">
                        <label class="mb-3 font-medium">{{ 'register.fields.services' | transloco }}</label>
                        <div class="flex flex-wrap gap-2">
                            @for (service of servicesKeys; track service) {
                                <button
                                    type="button"
                                    (click)="toggleService(service)"
                                    class="chip"
                                    [class.selected]="isServiceSelected(service)"
                                >
                                    {{ 'register.options.services.' + service | transloco }}
                                </button>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }

        <div class="flex gap-2 items-center">
            <input type="checkbox" formControlName="captcha" />
            <span>{{ 'register.captcha' | transloco }} *</span>
        </div>

        <div class="flex gap-2 items-center">
            <input type="checkbox" formControlName="terms" />
            <span>{{ 'register.cgu' | transloco }} *</span>
        </div>

        <button
            type="submit"
            class="px-4 py-2 rounded-lg text-[var(--primary-beige)] bg-grad-water-green disabled:bg-gray-400 block mx-auto"
            [disabled]="form.invalid || form.value.password !== form.value.confirmPassword"
            (click)="submit()"
        >
            {{ 'register.submit' | transloco }}
        </button>
    </form>
</div>
